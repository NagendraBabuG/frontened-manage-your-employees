{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.transformReply = exports.RedisClusterNodeLinkStates = exports.transformArguments = void 0;\n\nfunction transformArguments() {\n  return ['CLUSTER', 'NODES'];\n}\n\nexports.transformArguments = transformArguments;\nvar RedisClusterNodeLinkStates;\n\n(function (RedisClusterNodeLinkStates) {\n  RedisClusterNodeLinkStates[\"CONNECTED\"] = \"connected\";\n  RedisClusterNodeLinkStates[\"DISCONNECTED\"] = \"disconnected\";\n})(RedisClusterNodeLinkStates = exports.RedisClusterNodeLinkStates || (exports.RedisClusterNodeLinkStates = {}));\n\nfunction transformReply(reply) {\n  const lines = reply.split('\\n');\n  lines.pop(); // last line is empty\n\n  const mastersMap = new Map(),\n        replicasMap = new Map();\n\n  for (const line of lines) {\n    const [id, address, flags, masterId, pingSent, pongRecv, configEpoch, linkState, ...slots] = line.split(' '),\n          node = {\n      id,\n      address,\n      ...transformNodeAddress(address),\n      flags: flags.split(','),\n      pingSent: Number(pingSent),\n      pongRecv: Number(pongRecv),\n      configEpoch: Number(configEpoch),\n      linkState: linkState\n    };\n\n    if (masterId === '-') {\n      let replicas = replicasMap.get(id);\n\n      if (!replicas) {\n        replicas = [];\n        replicasMap.set(id, replicas);\n      }\n\n      mastersMap.set(id, { ...node,\n        slots: slots.map(slot => {\n          // TODO: importing & exporting (https://redis.io/commands/cluster-nodes#special-slot-entries)\n          const [fromString, toString] = slot.split('-', 2),\n                from = Number(fromString);\n          return {\n            from,\n            to: toString ? Number(toString) : from\n          };\n        }),\n        replicas\n      });\n    } else {\n      const replicas = replicasMap.get(masterId);\n\n      if (!replicas) {\n        replicasMap.set(masterId, [node]);\n      } else {\n        replicas.push(node);\n      }\n    }\n  }\n\n  return [...mastersMap.values()];\n}\n\nexports.transformReply = transformReply;\n\nfunction transformNodeAddress(address) {\n  const indexOfColon = address.indexOf(':'),\n        indexOfAt = address.indexOf('@', indexOfColon),\n        host = address.substring(0, indexOfColon);\n\n  if (indexOfAt === -1) {\n    return {\n      host,\n      port: Number(address.substring(indexOfColon + 1)),\n      cport: null\n    };\n  }\n\n  return {\n    host: address.substring(0, indexOfColon),\n    port: Number(address.substring(indexOfColon + 1, indexOfAt)),\n    cport: Number(address.substring(indexOfAt + 1))\n  };\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","transformReply","RedisClusterNodeLinkStates","transformArguments","reply","lines","split","pop","mastersMap","Map","replicasMap","line","id","address","flags","masterId","pingSent","pongRecv","configEpoch","linkState","slots","node","transformNodeAddress","Number","replicas","get","set","map","slot","fromString","toString","from","to","push","values","indexOfColon","indexOf","indexOfAt","host","substring","port","cport"],"sources":["C:/Users/gnage/node_modules/@redis/client/dist/lib/commands/CLUSTER_NODES.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.transformReply = exports.RedisClusterNodeLinkStates = exports.transformArguments = void 0;\nfunction transformArguments() {\n    return ['CLUSTER', 'NODES'];\n}\nexports.transformArguments = transformArguments;\nvar RedisClusterNodeLinkStates;\n(function (RedisClusterNodeLinkStates) {\n    RedisClusterNodeLinkStates[\"CONNECTED\"] = \"connected\";\n    RedisClusterNodeLinkStates[\"DISCONNECTED\"] = \"disconnected\";\n})(RedisClusterNodeLinkStates = exports.RedisClusterNodeLinkStates || (exports.RedisClusterNodeLinkStates = {}));\nfunction transformReply(reply) {\n    const lines = reply.split('\\n');\n    lines.pop(); // last line is empty\n    const mastersMap = new Map(), replicasMap = new Map();\n    for (const line of lines) {\n        const [id, address, flags, masterId, pingSent, pongRecv, configEpoch, linkState, ...slots] = line.split(' '), node = {\n            id,\n            address,\n            ...transformNodeAddress(address),\n            flags: flags.split(','),\n            pingSent: Number(pingSent),\n            pongRecv: Number(pongRecv),\n            configEpoch: Number(configEpoch),\n            linkState: linkState\n        };\n        if (masterId === '-') {\n            let replicas = replicasMap.get(id);\n            if (!replicas) {\n                replicas = [];\n                replicasMap.set(id, replicas);\n            }\n            mastersMap.set(id, {\n                ...node,\n                slots: slots.map(slot => {\n                    // TODO: importing & exporting (https://redis.io/commands/cluster-nodes#special-slot-entries)\n                    const [fromString, toString] = slot.split('-', 2), from = Number(fromString);\n                    return {\n                        from,\n                        to: toString ? Number(toString) : from\n                    };\n                }),\n                replicas\n            });\n        }\n        else {\n            const replicas = replicasMap.get(masterId);\n            if (!replicas) {\n                replicasMap.set(masterId, [node]);\n            }\n            else {\n                replicas.push(node);\n            }\n        }\n    }\n    return [...mastersMap.values()];\n}\nexports.transformReply = transformReply;\nfunction transformNodeAddress(address) {\n    const indexOfColon = address.indexOf(':'), indexOfAt = address.indexOf('@', indexOfColon), host = address.substring(0, indexOfColon);\n    if (indexOfAt === -1) {\n        return {\n            host,\n            port: Number(address.substring(indexOfColon + 1)),\n            cport: null\n        };\n    }\n    return {\n        host: address.substring(0, indexOfColon),\n        port: Number(address.substring(indexOfColon + 1, indexOfAt)),\n        cport: Number(address.substring(indexOfAt + 1))\n    };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}